language: generic
dist: trusty
services: docker
sudo: false
matrix:
  include:
    - name: x86_64-linux
    - name: aarch64-linux
      sudo: required
      env:
        - ARCH=arm64
      install:
        # Prepare QEMU.
        # https://github.com/multiarch/qemu-user-static
        # https://hub.docker.com/r/multiarch/ubuntu-debootstrap/tags/
        - docker run --rm --privileged multiarch/qemu-user-static:register --reset
        # Build container image.
        - |
          docker build --rm -t sample -f Dockerfile-${ARCH} .
      script: |
        docker run --rm -t sample ./sample_test.sh
    - name: i386-linux-simple
      sudo: required
      env:
        - ARCH=i386
      install: &prepare_qemu
        - docker run --rm --privileged multiarch/qemu-user-static:register --reset
      script: &test_arch
        - |
          docker run --rm -t multiarch/ubuntu-debootstrap:${ARCH}-bionic uname -a
    - name: aarch64-linux-simple
      sudo: required
      env:
        - ARCH=arm64
      install: *prepare_qemu
      script: *test_arch
    - name: armv7l-linux-simple
      sudo: required
      env:
        - ARCH=armhf
      install: *prepare_qemu
      script: *test_arch
    - name: ppc64el-linux-simple
      sudo: required
      env:
        - ARCH=ppc64el
      install: *prepare_qemu
      script: *test_arch
      # You can run non-important job only for cron mode
      # or any specific environment variable (ex: CI_CRON: 1) is set.
      if: type = cron OR env(CI_CRON) = 1
before_script:
  # Show environment.
  - uname -a
  - id
  - pwd
script:
  - ./sample_test.sh
